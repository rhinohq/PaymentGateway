@page "/basket"
@using Microsoft.AspNetCore.Authorization

@using PaymentGateway.Data.ViewModels

@inject HttpClient Http
@inject NavigationManager NavManager
@attribute [Authorize]

<div>
    <div style="float: right;">
        <button class="btn" @onclick="GoToCheckout">
            <span class="oi oi-cart" aria-hidden="true"></span> Checkout
        </button>
    </div>

    <h3>Basket @TitleAddendum</h3>
</div>

<br />

@if (UserBasket != null)
{
    <section class="products">
        @foreach (var item in UserBasket.Items)
        {
            <ProductMeta Prod="item.Product"></ProductMeta>
            <div>
                <input type="number" value="@item.Quantity" min="0" />
            </div>
        }
    </section>
}
else
{
    <p>Loading your basket...</p>
}

@code {
    public BasketDetail UserBasket { get; set; }

    public string TitleAddendum => UserBasket != null
        ? $"- {UserBasket.Size} Items"
        : string.Empty;

    protected override async Task OnInitializedAsync()
    {
        UserBasket = await Http.GetFromJsonAsync<BasketDetail>("Basket");
    }

    private void GoToCheckout()
    {
        NavManager.NavigateTo("/checkout");
    }
}
